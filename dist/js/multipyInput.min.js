/*!
 * jQuery multipyInput beta 1.0
 *
 * @date: 2016-08-08 
 *
 * @author: gong yuwen
 *
 */
+function(e){var b=e("script").last().attr("src").replace(/(?:[\w\.]+$)/,"");var d="multipyInput";var f={"Mobile":/^(?:(?:\+\d+\s?)?(?:\d\s?)?(?:\(\d(?:\s?-\s?)?\d*\))?(?:[\s-\.]?\d+)*)$/};var c={UP:38,DOWN:40,ENTER:13,ESC:27,PLUS:43,A:65,Z:90,SPACE:32,TAB:9};function a(h,g){this.$multiInput=e(h);this.options=g;this.ns="."+d;this.defaultPlaceHolder=this.$multiInput.prop("placeholder");this.$selectedFlag;this.$countryList;this.phoneUtil;this.allCountry;this.selectedCountryData;this.timer}a.prototype={_init:function(){this._generateFlag();this._initListeners();this._initRequest()},_generateFlag:function(){if(this.allCountry&&this.allCountry[0]){var o=new Object();for(var l in this.allCountry){var h=this.allCountry[l];var j=e("<li>",{"data-idn":h.IDN,"data-idc":h.IDC});var g=e("<div>",{"class":"flag-container"}).appendTo(j);e("<div>",{"class":"flag-item "+h.IDN}).appendTo(g);e("<span>",{"class":"country-name"}).text(h["name"]).appendTo(j);e("<span>",{"class":"dial-code"}).text("+"+h.IDC).appendTo(j);j.appendTo(this.$countryList);var k=h.IDC.substr(0,1);if(o[k]==undefined){o[k]=new Object()}o[k][h.IDC]={index:l,IDN:h.IDN}}this.allCountry=o}else{this.$multiInput.wrap(e("<div>",{"class":"multipyInput-container"}));var n=e("<div>",{"class":"flag-container dn",tabindex:0}).insertBefore(this.$multiInput);this.$selectedFlag=e("<div>",{"class":"selected-flag"}).appendTo(n);var m=e("<div>",{"class":"flag-item"}).appendTo(this.$selectedFlag);m.after(e("<div>",{"class":"flag-arrow"}));this.$countryList=e("<ul>",{"class":"country-list dn"}).insertAfter(this.$selectedFlag)}},_initListeners:function(){var g=this;this.$multiInput.on("loadComplete"+this.ns,function(){g._generateFlag()}).on("keyup"+this.ns,function(){if(g.timer){clearTimeout(g.timer)}g._analysisValue(this);g.timer=setTimeout(function(){var h=1},1000)}).on("cut"+this.ns+" paste"+this.ns,function(){g._analysisValue(this)})},_initRequest:function(){var g=this;var h=[e.getScript(b+"utils.js").done(function(){g.phoneUtil=window.intlTelInputUtils;if(g.allCountry!=undefined){g.$multiInput.trigger("loadComplete"+g.ns)}}),e.getJSON(b+"country.json").done(function(i){g.allCountry=i;if(g.phoneUtil!=undefined){g.$multiInput.trigger("loadComplete"+g.ns)}})];e.when(h)},_analysisValue:function(i){var j=e.trim(i.value);var g=this._getMatchType();if(j.length>0&&this.allCountry&&this.allCountry[0]==undefined){if(f["Mobile"].test(j)){var h="Mobile";this._analysisMobile(j)}else{var h="Other";this._reset()}}else{if(j.length==0){var h="Default";this.selectedCountryData=null;this._reset()}}if(g!=h){var k=e.Event("typechange"+this.ns,{multiInputType:h});this.$multiInput.trigger(k)}},_analysisMobile:function(k){k=k.replace(/[\(\)\s+]+/g,"");if(this.$selectedFlag.is(":hidden")||k.length<=4){var j=this.allCountry[k.substr(0,1)];var l=0;var g;for(var h in j){if(k.indexOf(h)==0){if(h.length>l){l=h.length;g=j[h].index}}}var m=e("li:eq("+g+")",this.$countryList);this._setSelectedFlag(m)}},_setSelectedFlag:function(g){var i=this;this.selectedCountryData={index:g.index(),IDN:g.data("idn"),IDC:g.data("idc")};e(".flag-item",this.$selectedFlag).removeAttr("class").addClass("flag-item "+this.selectedCountryData.IDN);var h=this.$selectedFlag.parent();if(h.is(":hidden")){h.css("display","table-cell");this.$selectedFlag.on("click"+this.ns,function(){i.$countryList.is(":visible")?i._hideCountryList():i._showCountryList();return false});h.on("keydown"+this.ns,function(j){if(i.$countryList.is(":hidden")&&(j.which==c.UP||j.which==c.DOWN||j.which==c.SPACE||j.which==c.ENTER)){j.preventDefault();j.stopPropagation();i._showCountryList()}if(j.which==c.TAB){i._hideCountryList()}})}this._setPlaceHolder()},_setPlaceHolder:function(){if(this.defaultPlaceHolder){if(this.$selectedFlag.is("visible")){var g=this.phoneUtil.getExampleNumber(this.selectedCountryData.IDN,true,this.phoneUtil.numberType.MOBILE)}else{var g=this.defaultPlaceHolder}this.$multiInput.prop("placeholder",g)}},_showCountryList:function(){this.$selectedFlag.find(".flag-arrow").addClass("open");var h;if(this.selectedCountryData){e("li.current",this.$countryList).removeClass("current highlight");var g=this.selectedCountryData.index;h=e("li:eq("+this.selectedCountryData.index+")",this.$countryList).addClass("current highlight")}this._bindListListeners();this.$countryList.show();if(h){this._scrollTo(h,true)}},_hideCountryList:function(){this.$countryList.hide();this.$selectedFlag.find(".flag-arrow").removeClass("open");e(document).off(this.ns);e("html").off(this.ns)},_scrollTo:function(o,r){var g=this.$countryList,q=g.height(),k=g.offset().top,p=k+q,m=o.outerHeight(),j=o.offset().top,n=j+m,h=j-k+g.scrollTop(),i=q/2-m/2;if(j<k){if(r){h-=i}g.scrollTop(h)}else{if(n>p){if(r){h+=i}var l=q-m;g.scrollTop(h-l)}}},_bindListListeners:function(){var g=this;e("html").on("click"+this.ns,function(j){var i=e(j.target);if(i.hasClass("dial-code")||i.hasClass("country-name")||i.hasClass("flag-item")){g._setSelectedFlag(i.closest("li"))
    }if(g.$countryList.is(":visible")){g._hideCountryList()}});var h="";this.timer=null;e(document).on("keydown"+this.ns,function(i){i.preventDefault();if(i.which==c.UP||i.which==c.DOWN){g._handleUpDownKey(i.which)}else{if(i.which==c.ENTER){g._handleEnterKey()}else{if(i.which==c.ESC){g._hideCountryList()}else{if(i.which>=c.A&&i.which<=c.Z||i.which==c.SPACE){if(g.timer){clearTimeout(g.timer)}h+=String.fromCharCode(i.which);g._searchForCountry(h);g.timer=setTimeout(function(){h=""},1000)}}}}})},_handleUpDownKey:function(h){var i=this.$countryList.find("li.highlight");var g=h==c.UP?i.first().prev():i.first().next();if(g.length){i.removeClass("highlight");g.addClass("highlight");this._scrollTo(g)}},_handleEnterKey:function(){var g=this.$countryList.find(".highlight:first");if(g.length){this._setSelectedFlag(g);this._hideCountryList()}},_searchForCountry:function(k){for(var j=0;j<this.$countryList.children().length;j++){var g=e("li:eq("+j+")",this.$countryList);var h=g.find(".country-name").text().toUpperCase();if(h.indexOf(k)==0){this.$countryList.find(".highlight").removeClass("highlight");g.addClass("highlight");this._scrollTo(g,true);break}}},_reset:function(){this.timer=null;e(".flag-item",this.$selectedFlag).removeAttr("class").addClass("flag-item");e("li.hightlight",this.$countryList).removeAttr("class");this._hideCountryList();var g=this.$selectedFlag.parent();g.hide();this.$selectedFlag.off(this.ns);g.off(this.ns);this._setPlaceHolder()},_getMatchType:function(){return this.$selectedFlag.is(":visible")?"Mobile":"Other"},_isValid:function(){if(this.$selectedFlag.is(":visible")&&this.selectedCountryData){return this.phoneUtil.isValidNumber(this.$multiInput.val(),this.selectedCountryData.IDN)}return true}};e.fn[d]=function(g){if(g==undefined||typeof g==="object"){this.each(function(){if(!e.data(this,"plugin_"+d)){var i=new a(this,g);i._init();e.data(this,"plugin_"+d,i)}})}else{if(typeof g==="string"){var h=e.data(this[0],"plugin_"+d);return h["_"+g]()}}}}(jQuery);